

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Welcome to the Docs</title>
  
  <meta name="author" content="Apache Mahout">

  <!-- Enable responsive viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Bootstrap styles -->
  <link href="/assets/themes/mahout3/css/bootstrap.min.css" rel="stylesheet">
  <!-- Optional theme -->
  <link href="/assets/themes/mahout3/css/bootstrap-theme.min.css" rel="stylesheet">
  <!-- Sticky Footer -->
  <link href="/assets/themes/mahout3/css/bs-sticky-footer.css" rel="stylesheet">

  <!-- Custom styles -->
  <link href="/assets/themes/mahout3/css/style.css" rel="stylesheet" type="text/css" media="all">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
  <![endif]-->

  <!-- Fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

  <!-- atom & rss feed -->
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
  <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
  </script>
  <script type="text/javascript">
    var mathjax = document.createElement('script');
    mathjax.type = 'text/javascript';
    mathjax.async = true;

    mathjax.src = ('https:' == document.location.protocol) ?
        'https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML' :
        'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';

      var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(mathjax, s);
  </script>
</head>

<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">
        <img src="/assets/img/Mahout-logo-82x100.png" height="30" alt="I'm mahout">
      </a>
    </div>

    


<!-- Collect the nav links, forms, and other content for toggling -->
<div class="collapse navbar-collapse" id="main-navbar">
    <ul class="nav navbar-nav">

        <!-- Quick Start -->
        <li id="quickstart">
            <a href="/index.html" >Mahout Overview</a>
        </li>

        <li id="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Key Concepts<span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="/index.html">Mahout Overview</a></li>
                <li><span><b>&nbsp;&nbsp;Scala DSL</b><span></li>
                <li><a href="/mahout-samsara/in-core-reference.html">In-core Reference</a></li>
                <li><a href="/mahout-samsara/out-of-core-reference.html">Out-of-core Reference</a></li>
                <li><a href="/mahout-samsara/faq.html">Samsara FAQ</a></li>
                <li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<b>Bindings</b><span></li>
                <li><a href="/distributed/spark-bindings/">Spark Bindings</a></li>
                <li><a href="/distributed/flink-bindings.html">Flink Bindings</a></li>
                <li><a href="/distributed/flink-bindings.html">H20 Bindings</a></li>
                <!--<li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<b>Native Solvers</b><span></li>
                <li><a href="/native-solvers/viennacl.html">ViennaCL</a></li>
                <li><a href="/native-solvers/viennacl-omp.html">ViennaCL-OMP</a></li>
                <li><a href="/native-solvers/cuda.html">CUDA</a></li>-->
            </ul>
        </li>

        <li id="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials<span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><span>&nbsp;&nbsp;<b>Reccomenders</b><span></li>
                <li><a href="/tutorials/cco-lastfm">CCO Example with Last.FM Data</a></li>
                <li><a href="/tutorials/intro-cooccurrence-spark">Introduction to Cooccurrence in Spark</a></li>
                <li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<b>Mahout Samsara</b><span></li>
                <li><a href="/tutorials/samsara/play-with-shell.html">Playing with Samsara in Spark Shell</a></li>
                <li><a href="/tutorials/samsara/playing-with-samsara-flink-batch.html">Playing with Samsara in Flink Batch</a></li>
                <li><a href="/tutorials/samsara/classify-a-doc-from-the-shell.html">Text Classification (Shell)</a></li>
                <li><a href="/tutorials/samsara/spark-naive-bayes.html">Spark Naive Bayes</a></li>
                <li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<b>Misc</b><span></li>
                <li><a href="/tutorials/misc/mahout-in-zeppelin">Mahout in Apache Zeppelin</a></li>
                <li><a href="/tutorials/misc/contributing-algos">How To Contribute a New Algorithm</a></li>
                <li><a href="/tutorials/misc/how-to-build-an-app.html">How To Build An App</a></li>
                <li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<b>Deprecated</b><span></li>
                <li><a href="/tutorials/map-reduce">MapReduce</a></li>
            </ul>
        </li>


        <!-- Algorithms (Samsara / MR) -->
        <li id="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Algorithms<span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="/algorithms/linear-algebra">Distributed Linear Algebra</a></li>
                <li><a href="/algorithms/preprocessors">Preprocessors</a></li>
                <li><a href="/algorithms/regression">Regression</a></li>
                <li><a href="/algorithms/reccomenders">Reccomenders</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="/algorithms/map-reduce">MapReduce <i>(deprecated)</i></a></li>
            </ul>
                <!--<li><a href="/algorithms/reccomenders/recommender-overview.html">Reccomender Overview</a></li> Do we still need? seems like short version of next post-->
                <!--
                <li><a href="/algorithms/reccomenders/intro-cooccurrence-spark.html">Intro to Coocurrence With Spark</a></li>
                <li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<a href="/algorithms/map-reduce"><b>MapReduce</b> (deprecated)</a><span></li>


             -->
        </li>

        <!-- Scala Docs -->
        <li id="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">API Docs<span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="/0.13.0/api/index.html">0.13.0</a></li>
            </ul>
        </li>


    </ul>
    <form class="navbar-form navbar-left">
        <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>
    </form>
    <ul class="nav navbar-nav navbar-right">
        <li><a href="http://github.com/apache/mahout">Github</a></li>

        <!-- Apache -->
        <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Apache <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="http://www.apache.org/foundation/how-it-works.html">Apache Software Foundation</a></li>
                <li><a href="http://www.apache.org/licenses/">Apache License</a></li>
                <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
            </ul>
        </li>

    </ul>
</div><!-- /.navbar-collapse -->

  </div><!-- /.container-fluid -->
</nav>

<body>

<div id="wrap">
  <body class="">

  <div class="container">
    

<div class="page-header">
  <h1>Welcome to the Docs  <small>Apache Mahout from 30,000 feet (10,000 meters)</small></h1>
</div>

<div class="row">
  <div class="col-xs-12">
    <p>You’ve probably already noticed Mahout has a lot of things going on at different levels, and it can be hard to know where
to start.  Let’s provide an overview to help you see how the pieces fit together. In general the stack is something like this:</p>

<ol>
  <li>Application Code</li>
  <li>Samsara Scala-DSL (Syntactic Sugar)</li>
  <li>Logical/Physical DAG</li>
  <li>Engine Bindings</li>
  <li>Code runs in Engine</li>
  <li>Native Solvers</li>
</ol>

<h2 id="application-code">Application Code</h2>

<p>You have an JAVA/Scala applicatoin (skip this if you’re working from an interactive shell or Apache Zeppelin)</p>

<pre><code>def main(args: Array[String]) {

  println("Welcome to My Mahout App")

  if (args.isEmpty) {
</code></pre>

<p>This may seem like a trivial part to call out, but the point is important- Mahout runs <em>inline</em> with your regular application 
code. E.g. if this is an Apache Spark app, then you do all your Spark things, including ETL and data prep in the same 
application, and then invoke Mahout’s mathematically expressive Scala DSL when you’re ready to math on it.</p>

<h2 id="samsara-scala-dsl-syntactic-sugar">Samsara Scala-DSL (Syntactic Sugar)</h2>

<p>So when you get to a point in your code where you’re ready to math it up (in this example Spark) you can elegently express 
yourself mathematically.</p>

<pre><code>implicit val sdc: org.apache.mahout.sparkbindings.SparkDistributedContext = sc2sdc(sc)

val A = drmWrap(rddA)
val B = drmWrap(rddB) 

val C = A.t %*% A + A %*% B.t
</code></pre>

<p>We’ve defined a <code>MahoutDistributedContext</code> (which is a wrapper on the Spark Context), and two Disitributed Row Matrices (DRMs)
which are wrappers around RDDs (in Spark).</p>

<h2 id="logical--physical-dag">Logical / Physical DAG</h2>

<p>At this point there is a bit of optimization that happens.  For example, consider the</p>

<pre><code>A.t %*% A
</code></pre>

<p>Which is</p>
<center>\(\mathbf{A^\intercal A}\)</center>

<p>Transposing a large matrix is a very expensive thing to do, and in this case we don’t actually need to do it. There is a
more efficient way to calculate <foo>\(\mathbf{A^\intercal A}\)</foo> that doesn’t require a physical transpose.</p>

<p>(Image showing this)</p>

<p>Mahout converts this code into something that looks like:</p>

<pre><code>OpAtA(A) + OpABt(A, B) //  illustrative pseudocode with real functions called
</code></pre>

<p>There’s a little more magic that happens at this level, but the punchline is <em>Mahout translates the pretty scala into a
a series of operators, which at the next level are turned implemented at the engine</em>.</p>

<h2 id="engine-bindings-and-engine-level-ops">Engine Bindings and Engine Level Ops</h2>

<p>When one creates new engine bindings, one is in essence defining</p>

<ol>
  <li>What the engine specific underlying structure for a DRM is (in Spark its an RDD).  The underlying structure also has 
rows of <code>MahoutVector</code>s, so in Spark <code>RDD[(index, MahoutVector)]</code>.  This will be important when we get to the native solvers.</li>
  <li>Implementing a set of BLAS (basic linear algebra) functions for working on the underlying structure- in Spark this means
implementing things like <code>AtA</code> on an RDD. See <a href="https://github.com/apache/mahout/tree/master/spark/src/main/scala/org/apache/mahout/sparkbindings">the sparkbindings on github</a></li>
</ol>

<p>Now your mathematically expresive Samsara Scala code has been translated into optimized engine specific functions.</p>

<h2 id="native-solvers">Native Solvers</h2>

<p>Recall how I said the rows of the DRMs are <code>org.apache.mahout.math.Vector</code>.  Here is where this becomes important. I’m going 
to explain this in the context of Spark, but the principals apply to all distributed backends.</p>

<p>If you are familiar with how mapping and reducing in Spark, then envision this RDD of <code>MahoutVector</code>s,  each partition, 
and indexed collection of vectors is a <em>block</em> of the distributed matrix, however this <em>block</em> is totally incore, and therefor
is treated like an in core matrix.</p>

<p>Now Mahout defines its own incore BLAS packs and refers to them as <em>Native Solvers</em>.  The default native solver is just plain
old JVM, which is painfully slow, but works just about anywhere.</p>

<p>When the data gets to the node and an operation on the matrix block is called.  In the same way Mahout converts abstract
operators on the DRM that are implemented on various distributed engines, it calls abstract operators on the incore matrix 
and vectors which are implemented on various native solvers.</p>

<p>The default “native solver” is the JVM, which isn’t native at all- and if no actual native solvers are present operations 
will fall back to this. However, IF a native solver is present (the jar was added to the notebook), then the magic will happen.</p>

<p>Imagine still we have our Spark executor- it has this block of a matrix sitting in its core. Now let’s suppose the <code>ViennaCl-OMP</code>
native solver is in use.  When Spark calls an operation on this incore matrix, the matrix dumps out of the JVM and the 
calculation is carried out on <em>all available CPUs</em>.</p>

<p>In a similar way, the <code>ViennaCL</code> native solver dumps the matrix out of the JVM and looks for a GPU to execute the operations on.</p>

<p>Once the operations are complete, the result is loaded back up into the JVM, and Spark (or whatever distributed engine) and 
shipped back to the driver.</p>

<p>The native solver operatoins are only defined on <code>org.apache.mahout.math.Vector</code> and <code>org.apache.mahout.math.Matrix</code>, which is 
why it is critical that the underlying structure composed row-wise of <code>Vector</code> or <code>Matrices</code>.</p>


  </div>
</div>


  </div>


</div>

<div id="footer">
  <div class="container">
    <p>&copy; 2017 Apache Mahout
      with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
      and <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>
    </p>
  </div>
</div>







<!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="/assets/themes/mahout3/js/bootstrap.min.js"></script>
</body>
</html>

