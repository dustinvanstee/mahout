

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>(Deprecated)  Parallel Frequent Pattern Mining</title>
  
  <meta name="author" content="Apache Mahout">

  <!-- Enable responsive viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Bootstrap styles -->
  <link href="/assets/themes/mahout3/css/bootstrap.min.css" rel="stylesheet">
  <!-- Optional theme -->
  <link href="/assets/themes/mahout3/css/bootstrap-theme.min.css" rel="stylesheet">
  <!-- Sticky Footer -->
  <link href="/assets/themes/mahout3/css/bs-sticky-footer.css" rel="stylesheet">

  <!-- Custom styles -->
  <link href="/assets/themes/mahout3/css/style.css" rel="stylesheet" type="text/css" media="all">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
  <![endif]-->

  <!-- Fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

  <!-- atom & rss feed -->
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
  <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
  </script>
  <script type="text/javascript">
    var mathjax = document.createElement('script');
    mathjax.type = 'text/javascript';
    mathjax.async = true;

    mathjax.src = ('https:' == document.location.protocol) ?
        'https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML' :
        'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';

      var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(mathjax, s);
  </script>
</head>

<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">
        <img src="/assets/img/Mahout-logo-82x100.png" height="30" alt="I'm mahout">
      </a>
    </div>

    


<!-- Collect the nav links, forms, and other content for toggling -->
<div class="collapse navbar-collapse" id="main-navbar">
    <ul class="nav navbar-nav">

        <!-- Quick Start -->
        <li id="quickstart">
            <a href="/index.html" >Mahout Overview</a>
        </li>

        <li id="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Key Concepts<span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="/index.html">Mahout Overview</a></li>
                <li><span><b>&nbsp;&nbsp;Scala DSL</b><span></li>
                <li><a href="/mahout-samsara/in-core-reference.html">In-core Reference</a></li>
                <li><a href="/mahout-samsara/out-of-core-reference.html">Out-of-core Reference</a></li>
                <li><a href="/mahout-samsara/faq.html">Samsara FAQ</a></li>
                <li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<b>Bindings</b><span></li>
                <li><a href="/distributed/spark-bindings/">Spark Bindings</a></li>
                <li><a href="/distributed/flink-bindings.html">Flink Bindings</a></li>
                <li><a href="/distributed/flink-bindings.html">H20 Bindings</a></li>
                <!--<li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<b>Native Solvers</b><span></li>
                <li><a href="/native-solvers/viennacl.html">ViennaCL</a></li>
                <li><a href="/native-solvers/viennacl-omp.html">ViennaCL-OMP</a></li>
                <li><a href="/native-solvers/cuda.html">CUDA</a></li>-->
            </ul>
        </li>

        <li id="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials<span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><span>&nbsp;&nbsp;<b>Reccomenders</b><span></li>
                <li><a href="/tutorials/cco-lastfm">CCO Example with Last.FM Data</a></li>
                <li><a href="/tutorials/intro-cooccurrence-spark">Introduction to Cooccurrence in Spark</a></li>
                <li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<b>Mahout Samsara</b><span></li>
                <li><a href="/tutorials/samsara/play-with-shell.html">Playing with Samsara in Spark Shell</a></li>
                <li><a href="/tutorials/samsara/playing-with-samsara-flink-batch.html">Playing with Samsara in Flink Batch</a></li>
                <li><a href="/tutorials/samsara/classify-a-doc-from-the-shell.html">Text Classification (Shell)</a></li>
                <li><a href="/tutorials/samsara/spark-naive-bayes.html">Spark Naive Bayes</a></li>
                <li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<b>Misc</b><span></li>
                <li><a href="/tutorials/misc/mahout-in-zeppelin">Mahout in Apache Zeppelin</a></li>
                <li><a href="/tutorials/misc/contributing-algos">How To Contribute a New Algorithm</a></li>
                <li><a href="/tutorials/misc/how-to-build-an-app.html">How To Build An App</a></li>
                <li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<b>Deprecated</b><span></li>
                <li><a href="/tutorials/map-reduce">MapReduce</a></li>
            </ul>
        </li>


        <!-- Algorithms (Samsara / MR) -->
        <li id="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Algorithms<span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="/algorithms/linear-algebra">Distributed Linear Algebra</a></li>
                <li><a href="/algorithms/preprocessors">Preprocessors</a></li>
                <li><a href="/algorithms/regression">Regression</a></li>
                <li><a href="/algorithms/reccomenders">Reccomenders</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="/algorithms/map-reduce">MapReduce <i>(deprecated)</i></a></li>
            </ul>
                <!--<li><a href="/algorithms/reccomenders/recommender-overview.html">Reccomender Overview</a></li> Do we still need? seems like short version of next post-->
                <!--
                <li><a href="/algorithms/reccomenders/intro-cooccurrence-spark.html">Intro to Coocurrence With Spark</a></li>
                <li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<a href="/algorithms/map-reduce"><b>MapReduce</b> (deprecated)</a><span></li>


             -->
        </li>

        <!-- Scala Docs -->
        <li id="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">API Docs<span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="/0.13.0/api/index.html">0.13.0</a></li>
            </ul>
        </li>


    </ul>
    <form class="navbar-form navbar-left">
        <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>
    </form>
    <ul class="nav navbar-nav navbar-right">
        <li><a href="http://github.com/apache/mahout">Github</a></li>

        <!-- Apache -->
        <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Apache <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="http://www.apache.org/foundation/how-it-works.html">Apache Software Foundation</a></li>
                <li><a href="http://www.apache.org/licenses/">Apache License</a></li>
                <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
            </ul>
        </li>

    </ul>
</div><!-- /.navbar-collapse -->

  </div><!-- /.container-fluid -->
</nav>

<body>

<div id="wrap">
  <body class="">

  <div class="container">
    <p>Mahout has a Top K Parallel FPGrowth Implementation. Its based on the paper <a href="http://infolab.stanford.edu/~echang/recsys08-69.pdf">http://infolab.stanford.edu/~echang/recsys08-69.pdf</a>
 with some optimisations in mining the data.</p>

<p>Given a huge transaction list, the algorithm finds all unique features(sets
of field values) and eliminates those features whose frequency in the whole
dataset is less that minSupport. Using these remaining features N, we find
the top K closed patterns for each of them, generating a total of NxK
patterns. FPGrowth Algorithm is a generic implementation, we can use any
Object type to denote a feature. Current implementation requires you to use
a String as the object type. You may implement a version for any object by
creating Iterators, Convertors and TopKPatternWritable for that particular
object. For more information please refer the package
org.apache.mahout.fpm.pfpgrowth.convertors.string</p>

<pre><code>e.g:
 FPGrowth&lt;String&gt; fp = new FPGrowth&lt;String&gt;();
 Set&lt;String&gt; features = new HashSet&lt;String&gt;();
 fp.generateTopKStringFrequentPatterns(
     new StringRecordIterator(new FileLineIterable(new File(input), encoding, false), pattern),
	fp.generateFList(
	  new StringRecordIterator(new FileLineIterable(new File(input), encoding, false), pattern), minSupport),
	 minSupport,
	maxHeapSize,
	features,
	new StringOutputConvertor(new SequenceFileOutputCollector&lt;Text, TopKStringPatterns&gt;(writer))
  );
</code></pre>

<ul>
  <li>The first argument is the iterator of transaction in this case its
Iterator&lt;List<String>&gt;</String></li>
  <li>The second argument is the output of generateFList function, which
returns the frequent items and their frequencies from the given database
transaction iterator</li>
  <li>The third argument is the minimum Support of the pattern to be generated</li>
  <li>The fourth argument is the maximum number of patterns to be mined for
each feature</li>
  <li>The fifth argument is the set of features for which the frequent patterns
has to be mined</li>
  <li>The last argument is an output collector which takes [key, value](key,-value.html)
 of Feature and TopK Patterns of the format [String,
List&lt;Pair&lt;List<String>, Long&gt;&gt;\] and writes them to the appropriate writer
class which takes care of storing the object, in this case in a Sequence
File Output format</String></li>
</ul>

<p><a name="ParallelFrequentPatternMining-RunningFrequentPatternGrowthviacommandline"></a></p>
<h2 id="running-frequent-pattern-growth-via-command-line">Running Frequent Pattern Growth via command line</h2>

<p>The command line launcher for string transaction data
org.apache.mahout.fpm.pfpgrowth.FPGrowthDriver has other features including
specifying the regex pattern for spitting a string line of a transaction
into the constituent features.</p>

<p>Input files have to be in the following format.</p>

<optional document="">TAB<TOKEN1>SPACE<TOKEN2>SPACE....

instead of tab you could use , or \| as the default tokenization is done using a java Regex pattern {code}[,\t](,\t.html)
*[,|\t][ ,\t]*{code}
You can override this parameter to parse your log files or transaction
files (each line is a transaction.) The FPGrowth algorithm mines the top K
frequently occurring sets of items and their counts from the given input
data

$MAHOUT_HOME/core/src/test/resources/retail.dat is a sample dataset in this
format. 
Other sample files are accident.dat.gz from [http://fimi.cs.helsinki.fi/data/](http://fimi.cs.helsinki.fi/data/)
. As a quick test, try this:


    bin/mahout fpg \
         -i core/src/test/resources/retail.dat \
         -o patterns \
         -k 50 \
         -method sequential \
         -regex '[\ ]
' \
         -s 2


The minimumSupport parameter \-s is the minimum number of times a pattern
or a feature needs to occur in the dataset so that it is included in the
patterns generated. You can speed up the process by having a large value of
s. There are cases where you will have less than k patterns for a
particular feature as the rest don't for qualify the minimum support
criteria

Note that the input to the algorithm, could be uncompressed or compressed
gz file or even a directory containing any number of such files.
We modified the regex to use space to split the token. Note that input
regex string is escaped.

<a name="ParallelFrequentPatternMining-RunningParallelFPGrowth"></a>
## Running Parallel FPGrowth

Running parallel FPGrowth is as easy as adding changing the flag \-method
mapreduce and adding the number of groups parameter e.g. \-g 20 for 20
groups. First, let's run the above sample test in map-reduce mode:

    bin/mahout fpg \
         -i core/src/test/resources/retail.dat \
         -o patterns \
         -k 50 \
         -method mapreduce \
         -regex '[\ ]
' \
         -s 2

The above test took 102 seconds on dual-core laptop, v.s. 609 seconds in
the sequential mode, (with 5 gigs of ram allocated). In a separate test,
the first 1000 lines of retail.dat took 20 seconds in map/reduce v.s. 30
seconds in sequential mode.

Here is another dataset which, while several times larger, requires much
less time to find frequent patterns, as there are very few. Get
accidents.dat.gz from [http://fimi.cs.helsinki.fi/data/](http://fimi.cs.helsinki.fi/data/)
 and place it on your hdfs in a folder named accidents. Then, run the
hadoop version of the FPGrowth job:

    bin/mahout fpg \
         -i accidents \
         -o patterns \
         -k 50 \
         -method mapreduce \
         -regex '[\ ]
' \
         -s 2


OR to run a dataset of this size in sequential mode on a single machine
let's give Mahout a lot more memory and only keep features with more than
300 members:

    export MAHOUT_HEAPSIZE=-Xmx5000m
    bin/mahout fpg \
         -i accidents \
         -o patterns \
         -k 50 \
         -method sequential \
         -regex '[\ ]
' \
         -s 2



The numGroups parameter \-g in FPGrowthJob specifies the number of groups
into which transactions have to be decomposed. The default of 1000 works
very well on a single-machine cluster; this may be very different on large
clusters.

Note that accidents.dat has 340 unique features. So we chose \-g 10 to
split the transactions across 10 shards where 34 patterns are mined from
each shard. (Note: g doesnt need to be exactly divisible.) The Algorithm
takes care of calculating the split. For better performance in large
datasets and clusters, try not to mine for more than 20-25 features per
shard. Stick to the defaults on a small machine.

The numTreeCacheEntries parameter \-tc specifies the number of generated
conditional FP-Trees to be kept in memory so that subsequent operations do
not to regenerate them. Increasing this number increases the memory
consumption but might improve speed until a certain point. This depends
entirely on the dataset in question. A value of 5-10 is recommended for
mining up to top 100 patterns for each feature.

<a name="ParallelFrequentPatternMining-Viewingtheresults"></a>
## Viewing the results
The output will be dumped to a SequenceFile in the frequentpatterns
directory in Text=&gt;TopKStringPatterns format. Run this command to see a few
of the Frequent Patterns:

    bin/mahout seqdumper \
         -i patterns/frequentpatterns/part-?-00000 \
         -n 4

or replace -n 4 with -c for the count of patterns.
 
Open questions: how does one experiment and monitor with these various
parameters?
</TOKEN2></TOKEN1></optional>

  </div>


</div>

<div id="footer">
  <div class="container">
    <p>&copy; 2017 Apache Mahout
      with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
      and <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>
    </p>
  </div>
</div>







<!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="/assets/themes/mahout3/js/bootstrap.min.js"></script>
</body>
</html>

