

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>(Deprecated)  Collocations</title>
  
  <meta name="author" content="Apache Mahout">

  <!-- Enable responsive viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Bootstrap styles -->
  <link href="/assets/themes/mahout3/css/bootstrap.min.css" rel="stylesheet">
  <!-- Optional theme -->
  <link href="/assets/themes/mahout3/css/bootstrap-theme.min.css" rel="stylesheet">
  <!-- Sticky Footer -->
  <link href="/assets/themes/mahout3/css/bs-sticky-footer.css" rel="stylesheet">

  <!-- Custom styles -->
  <link href="/assets/themes/mahout3/css/style.css" rel="stylesheet" type="text/css" media="all">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
  <![endif]-->

  <!-- Fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

  <!-- atom & rss feed -->
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
  <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
  </script>
  <script type="text/javascript">
    var mathjax = document.createElement('script');
    mathjax.type = 'text/javascript';
    mathjax.async = true;

    mathjax.src = ('https:' == document.location.protocol) ?
        'https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML' :
        'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';

      var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(mathjax, s);
  </script>
</head>

<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">
        <img src="/assets/img/Mahout-logo-82x100.png" height="30" alt="I'm mahout">
      </a>
    </div>

    


<!-- Collect the nav links, forms, and other content for toggling -->
<div class="collapse navbar-collapse" id="main-navbar">
    <ul class="nav navbar-nav">

        <!-- Quick Start -->
        <li id="quickstart">
            <a href="/index.html" >Mahout Overview</a>
        </li>

        <li id="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Key Concepts<span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="/index.html">Mahout Overview</a></li>
                <li><span><b>&nbsp;&nbsp;Scala DSL</b><span></li>
                <li><a href="/mahout-samsara/in-core-reference.html">In-core Reference</a></li>
                <li><a href="/mahout-samsara/out-of-core-reference.html">Out-of-core Reference</a></li>
                <li><a href="/mahout-samsara/faq.html">Samsara FAQ</a></li>
                <li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<b>Bindings</b><span></li>
                <li><a href="/distributed/spark-bindings/">Spark Bindings</a></li>
                <li><a href="/distributed/flink-bindings.html">Flink Bindings</a></li>
                <li><a href="/distributed/flink-bindings.html">H20 Bindings</a></li>
                <!--<li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<b>Native Solvers</b><span></li>
                <li><a href="/native-solvers/viennacl.html">ViennaCL</a></li>
                <li><a href="/native-solvers/viennacl-omp.html">ViennaCL-OMP</a></li>
                <li><a href="/native-solvers/cuda.html">CUDA</a></li>-->
            </ul>
        </li>

        <li id="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials<span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><span>&nbsp;&nbsp;<b>Reccomenders</b><span></li>
                <li><a href="/tutorials/cco-lastfm">CCO Example with Last.FM Data</a></li>
                <li><a href="/tutorials/intro-cooccurrence-spark">Introduction to Cooccurrence in Spark</a></li>
                <li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<b>Mahout Samsara</b><span></li>
                <li><a href="/tutorials/samsara/play-with-shell.html">Playing with Samsara in Spark Shell</a></li>
                <li><a href="/tutorials/samsara/playing-with-samsara-flink-batch.html">Playing with Samsara in Flink Batch</a></li>
                <li><a href="/tutorials/samsara/classify-a-doc-from-the-shell.html">Text Classification (Shell)</a></li>
                <li><a href="/tutorials/samsara/spark-naive-bayes.html">Spark Naive Bayes</a></li>
                <li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<b>Misc</b><span></li>
                <li><a href="/tutorials/misc/mahout-in-zeppelin">Mahout in Apache Zeppelin</a></li>
                <li><a href="/tutorials/misc/contributing-algos">How To Contribute a New Algorithm</a></li>
                <li><a href="/tutorials/misc/how-to-build-an-app.html">How To Build An App</a></li>
                <li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<b>Deprecated</b><span></li>
                <li><a href="/tutorials/map-reduce">MapReduce</a></li>
            </ul>
        </li>


        <!-- Algorithms (Samsara / MR) -->
        <li id="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Algorithms<span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="/algorithms/linear-algebra">Distributed Linear Algebra</a></li>
                <li><a href="/algorithms/preprocessors">Preprocessors</a></li>
                <li><a href="/algorithms/regression">Regression</a></li>
                <li><a href="/algorithms/reccomenders">Reccomenders</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="/algorithms/map-reduce">MapReduce <i>(deprecated)</i></a></li>
            </ul>
                <!--<li><a href="/algorithms/reccomenders/recommender-overview.html">Reccomender Overview</a></li> Do we still need? seems like short version of next post-->
                <!--
                <li><a href="/algorithms/reccomenders/intro-cooccurrence-spark.html">Intro to Coocurrence With Spark</a></li>
                <li role="separator" class="divider"></li>
                <li><span>&nbsp;&nbsp;<a href="/algorithms/map-reduce"><b>MapReduce</b> (deprecated)</a><span></li>


             -->
        </li>

        <!-- Scala Docs -->
        <li id="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">API Docs<span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="/0.13.0/api/index.html">0.13.0</a></li>
            </ul>
        </li>


    </ul>
    <form class="navbar-form navbar-left">
        <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>
    </form>
    <ul class="nav navbar-nav navbar-right">
        <li><a href="http://github.com/apache/mahout">Github</a></li>

        <!-- Apache -->
        <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Apache <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="http://www.apache.org/foundation/how-it-works.html">Apache Software Foundation</a></li>
                <li><a href="http://www.apache.org/licenses/">Apache License</a></li>
                <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
            </ul>
        </li>

    </ul>
</div><!-- /.navbar-collapse -->

  </div><!-- /.container-fluid -->
</nav>

<body>

<div id="wrap">
  <body class="">

  <div class="container">
    


<div class="row">
    <div class="col-md-3">
        <div id="AlgoMenu">
    <span><b>Mahout-Samsara Algorithms</b></span>
    <div class="list-group panel">
        <a href="#linalg" class="list-group-item list-group-item-success" data-toggle="collapse" data-parent="#AlgoMenu"><b>Linear Algebra</b><i class="fa fa-caret-down"></i></a>
        <div class="collapse" id="linalg">
            <ul class="nav sidebar-nav">
                <li> <a href="/algorithms/linear-algebra/d-qr.html">Distributed QR Decomposition</a></li>
                <li> <a href="/algorithms/linear-algebra/d-spca.html">Distributed Stochastic Principal Component Analysis</a></li>
                <li> <a href="/algorithms/linear-algebra/d-ssvd.html">Distributed Stochastic Singular Value Decomposition</a></li>
            </ul>
        </div>
        <a href="#clustering" class="list-group-item list-group-item-success" data-toggle="collapse" data-parent="#AlgoMenu"><b>Clustering</b><i class="fa fa-caret-down"></i></a>
        <div class="collapse" id="clustering">
            <ul class="nav sidebar-nav">
                <li> <a href="/algorithms/clustering">Clustering Algorithms</a></li>
                <li> <a href="/algorithms/clustering/distance-metrics.html">Distance Metrics</a></li>
                <li> <a href="/algorithms/clustering/canopy">Canopy Clustering</a></li>
            </ul>
        </div>
        <a href="#preprocessors" class="list-group-item list-group-item-success" data-toggle="collapse" data-parent="#AlgoMenu"><b>Preprocessors</b><i class="fa fa-caret-down"></i></a>
        <div class="collapse" id="preprocessors">
            <ul class="nav sidebar-nav">
                <li> <a href="/algorithms/preprocessors/AsFactor.html">AsFactor (a.k.a. One-Hot-Encoding)</a></li>
                <li> <a href="/algorithms/preprocessors/StandardScaler.html">StandardScaler</a></li>
                <li> <a href="/algorithms/preprocessors/MeanCenter.html">MeanCenter</a></li>
            </ul>
        </div>
        <a href="#regression" class="list-group-item list-group-item-success" data-toggle="collapse" data-parent="#AlgoMenu"><b>Regression</b><i class="fa fa-caret-down"></i></a>
        <div class="collapse" id="regression">
            <ul class="nav sidebar-nav">
                <a href="#serial-correlation" class="list-group-item list-group-item-success" data-toggle="collapse" data-parent="#regression"><b>&#8226;&nbsp;Serial Correlation</b><i class="fa fa-caret-down"></i></a>
                <div class="collapse" id="serial-correlation">
                    <ul class="nav sidebar-nav">
                        <li> <a href="/algorithms/regression/serial-correlation/cochrane-orcutt.html">Cochrane-Orcutt Procedure</a></li>
                        <li> <a href="/algorithms/regression/serial-correlation/dw-test.html">Durbin Watson Test</a></li>
                    </ul>
                </div>
                <li> <a href="/algorithms/regression/ols.html">Ordinary Least Squares (Closed Form)</a></li>
                <li> <a href="/algorithms/regression/fittness-tests.html">Fitness Tests</a></li>
            </ul>
        </div>
        <a href="#reccomenders" class="list-group-item list-group-item-success" data-toggle="collapse" data-parent="#AlgoMenu"><b>Reccomenders</b><i class="fa fa-caret-down"></i></a>
        <div class="collapse" id="reccomenders">
            <ul class="nav sidebar-nav">
                <li> <a href="/algorithms/reccomenders">Reccomender Overview</a></li>
                <li> <a href="/algorithms/reccomenders/cco.html">CCO</a></li>
                <li> <a href="/algorithms/reccomenders/d-als.html">Distributed Alternating Least Squares</a></li>
            </ul>
        </div>
    </div>
    <span><b>Map Reduce Algorithms</b> (deprecated)</span>
    <div class="list-group panel">
        <a href="#classification" class="list-group-item list-group-item-success" data-toggle="collapse" data-parent="#AlgoMenu"><b>Classification</b><i class="fa fa-caret-down"></i></a>
        <div class="collapse" id="classification">
            <ul class="nav sidebar-nav">
                <li> <a href="/algorithms/map-reduce/classification/bayesian.html">Bayesian</a></li>
                <li> <a href="/algorithms/map-reduce/classification/class-discovery.html">Class Discovery</a></li>
                <li> <a href="/algorithms/map-reduce/classification/classifyingyourdata.html">Classifying Your Data</a></li>
                <li> <a href="/algorithms/map-reduce/classification/collocations.html">Collocation</a></li>
                <li> <a href="/algorithms/map-reduce/classification/gaussian-discriminative-analysis.html">Gaussian Discriminative Analysis</a></li>
                <li> <a href="/algorithms/map-reduce/classification/hidden-markov-models.html">Hidden Markov Models</a></li>
                <li> <a href="/algorithms/map-reduce/classification/independent-component-analysis.html">Independent Component Analysis</a></li>
                <li> <a href="/algorithms/map-reduce/classification/locally-weighted-linear-regression.html">Locally Weighted Linear Regression</a></li>
                <li> <a href="/algorithms/map-reduce/classification/logistic-regression.html">Logistic Regression</a></li>
                <li> <a href="/algorithms/map-reduce/classification/mahout-collections.html">Mahout Collections</a></li>
                <li> <a href="/algorithms/map-reduce/classification/mlp.html">Multilayer Perceptron</a></li>
                <li> <a href="/algorithms/map-reduce/classification/naivebayes.html">Naive Bayes</a></li>
                <li> <a href="/algorithms/map-reduce/classification/neural-network.html">Neural Networks</a></li>
                <li> <a href="/algorithms/map-reduce/classification/partial-implementation.html">Partial Implementation</a></li>
                <li> <a href="/algorithms/map-reduce/classification/random-forrests.html">Random Forrests</a></li>
                <li> <a href="/algorithms/map-reduce/classification/restricted-boltzman-machines.html">Restricted Boltzman Machines</a></li>
                <li> <a href="/algorithms/map-reduce/classification/support-vector-machines.html">Support Vector Machines</a></li>
            </ul>
        </div>
        <a href="#mr-clustering" class="list-group-item list-group-item-success" data-toggle="collapse" data-parent="#AlgoMenu"><b>Clustering</b><i class="fa fa-caret-down"></i></a>
        <div class="collapse" id="mr-clustering">
            <ul class="nav sidebar-nav">
                <li> <a href="/algorithms/map-reduce/clustering/canopy-clustering.html">Canopy Clustering</a></li>
                <li> <a href="/algorithms/map-reduce/clustering/cluster-dumper.html">Cluster Dumper</a></li>
                <li> <a href="/algorithms/map-reduce/clustering/expectation-maximization.html">Expectation Maximization</a></li>
                <li> <a href="/algorithms/map-reduce/clustering/fuzzy-k-means.html">Fuzzy K-Means</a></li>
                <li> <a href="/algorithms/map-reduce/clustering/hierarchical-clustering.html">Hierarchical Clustering</a></li>
                <li> <a href="/algorithms/map-reduce/clustering/k-means-clustering.html">K-Means Clustering</a></li>
                <li> <a href="/algorithms/map-reduce/clustering/latent-dirichlet-allocation.html">Latent Dirichlet Allocation</a></li>
                <li> <a href="/algorithms/map-reduce/clustering/llr---log-likelihood-ratio.html">Log Likelihood Ratio</a></li>
                <li> <a href="/algorithms/map-reduce/clustering/spectral-clustering.html">Spectral Clustering</a></li>
                <li> <a href="/algorithms/map-reduce/clustering/streaming-k-means.html">Streaming K-Means</a></li>
            </ul>
        </div>
    </div>
</div>

    </div>

    <div class="col-md-8">
        <div class="page-header">
            <h1>(Deprecated)  Collocations </h1>
        </div>
        <p><a name="Collocations-CollocationsinMahout"></a></p>
<h1 id="collocations-in-mahout">Collocations in Mahout</h1>

<p>A collocation is defined as a sequence of words or terms which co-occur
more often than would be expected by chance. Statistically relevant
combinations of terms identify additional lexical units which can be
treated as features in a vector-based representation of a text. A detailed
discussion of collocations can be found on <a href="http://en.wikipedia.org/wiki/Collocation">Wikipedia</a>.</p>

<p>See there for a more detailed discussion of collocations in the <a href="http://comments.gmane.org/gmane.comp.apache.mahout.user/5685">Reuters example</a>.</p>

<p><a name="Collocations-Log-LikelihoodbasedCollocationIdentification"></a></p>
<h2 id="theory-behind-implementation-log-likelihood-based-collocation-identification">Theory behind implementation: Log-Likelihood based Collocation Identification</h2>

<p>Mahout provides an implementation of a collocation identification algorithm
which scores collocations using log-likelihood ratio. The log-likelihood
score indicates the relative usefulness of a collocation with regards other
term combinations in the text. Collocations with the highest scores in a
particular corpus will generally be more useful as features.</p>

<p>Calculating the LLR is very straightforward and is described concisely in
<a href="http://tdunning.blogspot.com/2008/03/surprise-and-coincidence.html">Ted Dunning’s blog post</a>
. Ted describes the series of counts reqired to calculate the LLR for two
events A and B in order to determine if they co-occur more often than pure
chance. These counts include the number of times the events co-occur (k11),
the number of times the events occur without each other (k12 and k21), and
the number of times anything occurs. These counts are summarized in the
following table:</p>

<table>
<tr><td> </td><td> Event A </td><td> Everything but Event A </td></tr>
<tr><td> Event B </td><td> A and B together (k11) </td><td>  B but not A (k12) </td></tr>
<tr><td> Everything but Event B </td><td> A but not B (k21) </td><td> Neither B nor A (k22) </td></tr>
</table>

<p>For the purposes of collocation identification, it is useful to begin by
thinking in word pairs, bigrams. In this case the leading or head term from
the pair corresponds to A from the table above, B corresponds to the
trailing or tail term, while neither B nor A is the total number of word
pairs in the corpus less those containing B, A or both B and A.</p>

<p>Given the word pair of ‘oscillation overthruster’, the Log-Likelihood ratio
is computed by looking at the number of occurences of that word pair in the
corpus, the number of word pairs that begin with ‘oscillation’ but end with
something other than ‘overthruster’, the number of word pairs that end with
‘overthruster’ begin with something other than ‘oscillation’ and the number
of word pairs in the corpus that contain neither ‘oscillation’ and
overthruster.</p>

<p>This can be extended from bigrams to trigrams, 4-grams and beyond. In these
cases, the current algorithm uses the first token of the ngram as the head
of the ngram and the remaining n-1 tokens from the ngram, the n-1gram as it
were, as the tail. Given the trigram ‘hong kong cavaliers’, ‘hong’ is
treated as the head while ‘kong cavaliers’ is treated as the tail. Future
versions of this algorithm will allow for variations in which tokens of the
ngram are treated as the head and tail.</p>

<p>Beyond ngrams, it is often useful to inspect cases where individual words
occur around other interesting features of the text such as sentence
boundaries.</p>

<p><a name="Collocations-GeneratingNGrams"></a></p>
<h2 id="generating-ngrams">Generating NGrams</h2>

<p>The tools that the collocation identification algorithm are embeeded within
either consume tokenized text as input or provide the ability to specify an
implementation of the Lucene Analyzer class perform tokenization in order
to form ngrams. The tokens are passed through a Lucene ShingleFilter to
produce NGrams of the desired length.</p>

<p>Given the text “Alice was beginning to get very tired” as an example,
Lucene’s StandardAnalyzer produces the tokens ‘alice’, ‘beginning’, ‘get’,
‘very’ and ‘tired’, while the ShingleFilter with a max NGram size set to 3
produces the shingles ‘alice beginning’, ‘alice beginning get’, ‘beginning
get’, ‘beginning get very’, ‘get very’, ‘get very tired’ and ‘very tired’.
Note that both bigrams and trigrams are produced here. A future enhancement
to the existing algorithm would involve limiting the output to a particular
gram size as opposed to solely specifiying a max ngram size.</p>

<p><a name="Collocations-RunningtheCollocationIdentificationAlgorithm."></a></p>
<h2 id="running-the-collocation-identification-algorithm">Running the Collocation Identification Algorithm.</h2>

<p>There are a couple ways to run the llr-based collocation algorithm in
mahout</p>

<p><a name="Collocations-Whencreatingvectorsfromasequencefile"></a></p>
<h3 id="when-creating-vectors-from-a-sequence-file">When creating vectors from a sequence file</h3>

<p>The llr collocation identifier is integrated into the process that is used
to create vectors from sequence files of text keys and values. Collocations
are generated when the –maxNGramSize (-ng) option is not specified and
defaults to 2 or is set to a number of 2 or greater. The –minLLR option
can be used to control the cutoff that prevents collocations below the
specified LLR score from being emitted, and the –minSupport argument can
be used to filter out collocations that appear below a certain number of
times.</p>

<pre><code>bin/mahout seq2sparse

Usage:									    
     [--minSupport &lt;minSupport&gt; --analyzerName &lt;analyzerName&gt; --chunkSize &lt;chunkSize&gt;
      --output &lt;output&gt; --input &lt;input&gt; --minDF &lt;minDF&gt;
      --maxDFPercent&lt;maxDFPercent&gt; --weight &lt;weight&gt; --norm &lt;norm&gt; --minLLR &lt;minLLR&gt;
      --numReducers  &lt;numReducers&gt; --maxNGramSize &lt;ngramSize&gt; --overwrite --help		    
      --sequentialAccessVector]
Options 								    

  --minSupport (-s) minSupport	  (Optional) Minimum Support. Default Value: 2				    

  --analyzerName (-a) analyzerName    The class name of the analyzer

  --chunkSize (-chunk) chunkSize      The chunkSize in MegaBytes. 100-10000MB

  --output (-o) output		 The output directory

  --input (-i) input		   Input dir containing the documents in sequence file format

  --minDF (-md) minDF		  The minimum document frequency. Default is 1

  --maxDFPercent (-x) maxDFPercent    The max percentage of docs for the DF. Can be used to remove 
                                      really high frequency terms. Expressed as an
                                      integer between 0 and 100. Default is 99.     

  --weight (-wt) weight 	      The kind of weight to use. Currently TF   
				      or TFIDF				    

  --norm (-n) norm		      The norm to use, expressed as either a    
				      float or "INF" if you want to use the 
				      Infinite norm.  Must be greater orequal  
				      to 0.  The default is not to normalize    

  --minLLR (-ml) minLLR 	      (Optional)The minimum Log Likelihood  
				      Ratio(Float)  Default is 1.0
    
  --numReducers (-nr) numReducers     (Optional) Number of reduce tasks.    
				      Default Value: 1			    

  --maxNGramSize (-ng) ngramSize      (Optional) The maximum size of ngrams to  
				      create (2 = bigrams, 3 = trigrams, etc)   
				      Default Value:2			 
   
  --overwrite (-w)		      If set, overwrite the output directory    
  --help (-h)			      Print out help			    
  --sequentialAccessVector (-seq)     (Optional) Whether output vectors should	
				      be SequentialAccessVectors If set true	
				      else false 
</code></pre>

<p><a name="Collocations-CollocDriver"></a></p>
<h3 id="collocdriver">CollocDriver</h3>

<pre><code>bin/mahout org.apache.mahout.vectorizer.collocations.llr.CollocDriver

Usage:									    
 [--input &lt;input&gt; --output &lt;output&gt; --maxNGramSize &lt;ngramSize&gt; --overwrite    
--minSupport &lt;minSupport&gt; --minLLR &lt;minLLR&gt; --numReducers &lt;numReducers&gt;     
--analyzerName &lt;analyzerName&gt; --preprocess --unigram --help]

Options 								    

  --input (-i) input		      The Path for input files. 	    

  --output (-o) output		      The Path write output to		    

  --maxNGramSize (-ng) ngramSize      (Optional) The maximum size of ngramsto  
				      create (2 = bigrams, 3 = trigrams,etc)   
				      Default Value:2			

  --overwrite (-w)		      If set, overwrite the outputdirectory    

  --minSupport (-s) minSupport	      (Optional) Minimum Support. Default   
				      Value: 2				    

  --minLLR (-ml) minLLR 	      (Optional)The minimum Log Likelihood
				      Ratio(Float)  Default is 1.0	  
  
  --numReducers (-nr) numReducers     (Optional) Number of reduce tasks.    
				      Default Value: 1			    

  --analyzerName (-a) analyzerName    The class name of the analyzer	    

  --preprocess (-p)		      If set, input is SequenceFile&lt;Text,Text&gt;  
				      where the value is the document, which	
				      will be tokenized using the specified 
				      analyzer. 			

  --unigram (-u)		      If set, unigrams will be emitted inthe   
				      final output alongside collocations
   
  --help (-h)			      Print out help	      
</code></pre>

<p><a name="Collocations-Algorithmdetails"></a></p>
<h2 id="algorithm-details">Algorithm details</h2>

<p>This section describes the implementation of the collocation identification
algorithm in terms of the map-reduce phases that are used to generate
ngrams and count the frequencies required to perform the log-likelihood
calculation. Unless otherwise noted, classes that are indicated in
CamelCase can be found in the mahout-utils module under the package
org.apache.mahout.utils.nlp.collocations.llr</p>

<p>The algorithm is implemented in two map-reduce passes:</p>

<p><a name="Collocations-Pass1:CollocDriver.generateCollocations(...)"></a></p>
<h3 id="pass-1-collocdrivergeneratecollocations">Pass 1: CollocDriver.generateCollocations(…)</h3>

<p>Generates NGrams and counts frequencies for ngrams, head and tail subgrams.</p>

<p><a name="Collocations-Map:CollocMapper"></a></p>
<h4 id="map-collocmapper">Map: CollocMapper</h4>

<p>Input k: Text (documentId), v: StringTuple (tokens)</p>

<p>Each call to the mapper passes in the full set of tokens for the
corresponding document using a StringTuple. The ShingleFilter is run across
these tokens to produce ngrams of the desired length. ngrams and
frequencies are collected across the entire document.</p>

<p>Once this is done, ngrams are split into head and tail portions. A key of type GramKey is generated which is used later to join ngrams with their heads and tails in the reducer phase. The GramKey is a composite key made up of a string n-gram fragement as the primary key and a secondary key used for grouping and sorting in the reduce phase. The secondary key will either be EMPTY in the case where we are collecting either the head or tail of an ngram as the value or it will contain the byte<a href=".html"></a>
 form of the ngram when collecting an ngram as the value.</p>

<pre><code>head_key(EMPTY) -&gt; (head subgram, head frequency)

head_key(ngram) -&gt; (ngram, ngram frequency) 

tail_key(EMPTY) -&gt; (tail subgram, tail frequency)

tail_key(ngram) -&gt; (ngram, ngram frequency)
</code></pre>

<p>subgram and ngram values are packaged in Gram objects.</p>

<p>For each ngram found, the Count.NGRAM_TOTAL counter is incremented. When
the pass is complete, this counter will hold the total number of ngrams
encountered in the input which is used as a part of the LLR calculation.</p>

<p>Output k: GramKey (head or tail subgram), v: Gram (head, tail or ngram with
frequency)</p>

<p><a name="Collocations-Combiner:CollocCombiner"></a></p>
<h4 id="combiner-colloccombiner">Combiner: CollocCombiner</h4>

<p>Input k: GramKey, v:Gram (as above)</p>

<p>This phase merges the counts for unique ngrams or ngram fragments across
multiple documents. The combiner treats the entire GramKey as the key and
as such, identical tuples from separate documents are passed into a single
call to the combiner’s reduce method, their frequencies are summed and a
single tuple is passed out via the collector.</p>

<p>Output k: GramKey, v:Gram</p>

<p><a name="Collocations-Reduce:CollocReducer"></a></p>
<h4 id="reduce-collocreducer">Reduce: CollocReducer</h4>

<p>Input k: GramKey, v: Gram (as above)</p>

<p>The CollocReducer employs the Hadoop secondary sort strategy to avoid
caching ngram tuples in memory in order to calculate total ngram and
subgram frequencies. The GramKeyPartitioner ensures that tuples with the
same primary key are sent to the same reducer while the
GramKeyGroupComparator ensures that iterator provided by the reduce method
first returns the subgram and then returns ngram values grouped by ngram.
This eliminates the need to cache the values returned by the iterator in
order to calculate total frequencies for both subgrams and ngrams. There
input will consist of multiple frequencies for each (subgram_key, subgram)
or (subgram_key, ngram) tuple; one from each map task executed in which the
particular subgram was found.
The input will be traversed in the following order:</p>

<pre><code>(head subgram, frequency 1)
(head subgram, frequency 2)
... 
(head subgram, frequency N)
(ngram 1, frequency 1)
(ngram 1, frequency 2)
...
(ngram 1, frequency N)
(ngram 2, frequency 1)
(ngram 2, frequency 2)
...
(ngram 2, frequency N)
...
(ngram N, frequency 1)
(ngram N, frequency 2)
...
(ngram N, frequency N)
</code></pre>

<p>Where all of the ngrams above share the same head. Data is presented in the
same manner for the tail subgrams.</p>

<p>As the values for a subgram or ngram are traversed, frequencies are
accumulated. Once all values for a subgram or ngram are processed the
resulting key/value pairs are passed to the collector as long as the ngram
frequency is equal to or greater than the specified minSupport. When an
ngram is skipped in this way the Skipped.LESS_THAN_MIN_SUPPORT counter to
be incremented.</p>

<p>Pairs are passed to the collector in the following format:</p>

<pre><code>ngram, ngram frequency -&gt; subgram subgram frequency
</code></pre>

<p>In this manner, the output becomes an unsorted version of the following:</p>

<pre><code>ngram 1, frequency -&gt; ngram 1 head, head frequency
ngram 1, frequency -&gt; ngram 1 tail, tail frequency
ngram 2, frequency -&gt; ngram 2 head, head frequency
ngram 2, frequency -&gt; ngram 2 tail, tail frequency
ngram N, frequency -&gt; ngram N head, head frequency
ngram N, frequency -&gt; ngram N tail, tail frequency
</code></pre>

<p>Output is in the format k:Gram (ngram, frequency), v:Gram (subgram,
frequency)</p>

<p><a name="Collocations-Pass2:CollocDriver.computeNGramsPruneByLLR(...)"></a></p>
<h3 id="pass-2-collocdrivercomputengramsprunebyllr">Pass 2: CollocDriver.computeNGramsPruneByLLR(…)</h3>

<p>Pass 1 has calculated full frequencies for ngrams and subgrams, Pass 2
performs the LLR calculation.</p>

<p><a name="Collocations-MapPhase:IdentityMapper(org.apache.hadoop.mapred.lib.IdentityMapper)"></a></p>
<h4 id="map-phase-identitymapper-orgapachehadoopmapredlibidentitymapper">Map Phase: IdentityMapper (org.apache.hadoop.mapred.lib.IdentityMapper)</h4>

<p>This phase is a no-op. The data is passed through unchanged. The rest of
the work for llr calculation is done in the reduce phase.</p>

<p><a name="Collocations-ReducePhase:LLRReducer"></a></p>
<h4 id="reduce-phase-llrreducer">Reduce Phase: LLRReducer</h4>

<p>Input is k:Gram, v:Gram (as above)</p>

<p>This phase receives the head and tail subgrams and their frequencies for
each ngram (with frequency) produced for the input:</p>

<pre><code>ngram 1, frequency -&gt; ngram 1 head, frequency; ngram 1 tail, frequency
ngram 2, frequency -&gt; ngram 2 head, frequency; ngram 2 tail, frequency
...
ngram 1, frequency -&gt; ngram N head, frequency; ngram N tail, frequency
</code></pre>

<p>It also reads the full ngram count obtained from the first pass, passed in
as a configuration option. The parameters to the llr calculation are
calculated as follows:</p>

<p>k11 = f_n
k12 = f_h - f_n
k21 = f_t - f_n
k22 = N - ((f_h + f_t) - f_n)</p>

<p>Where f_n is the ngram frequency, f_h and f_t the frequency of head and
tail and N is the total number of ngrams.</p>

<p>Tokens with a llr below that of the specified minimum llr are dropped and
the Skipped.LESS_THAN_MIN_LLR counter is incremented.</p>

<p>Output is k: Text (ngram), v: DoubleWritable (llr score)</p>

<p><a name="Collocations-Unigrampass-through."></a></p>
<h3 id="unigram-pass-through">Unigram pass-through.</h3>

<p>By default in seq2sparse, or if the -u option is provided to the
CollocDriver, unigrams (single tokens) will be passed through the job and
each token’s frequency will be calculated. As with ngrams, unigrams are
subject to filtering with minSupport and minLLR.</p>


    </div>
</div>

  </div>


</div>

<div id="footer">
  <div class="container">
    <p>&copy; 2017 Apache Mahout
      with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
      and <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>
    </p>
  </div>
</div>







<!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="/assets/themes/mahout3/js/bootstrap.min.js"></script>
</body>
</html>

